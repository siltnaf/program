C51 COMPILER V9.54   MAIN                                                                  03/08/2021 17:04:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4           
   5          #include "./public/inc/config.h" 
   6          #include "./public/inc/delay.h"  
   7          #include "./public/inc/init.h"
   8          #include "./public/inc/process.h"
   9          
  10          volatile uint8 state,next_state,switch_state;
  11          volatile uint8   LED_type;
  12          volatile uint16 process_time,buz_time,key_holdtime;
  13          volatile uint16 Time_us, Time_ms,Time_sec,Time_min,Time_cnt,scan_sec;
  14          volatile bit Timer_update,Beep, UV_on, ion_on,switch_update,scan,unlock;
  15          
  16          
  17          
  18          void DCDC_enable(void)
  19          {
  20   1      
  21   1        
  22   1        
  23   1      //  
  24   1      //  SET_INPUT(IO_VCC_det);                
  25   1      //  if ((VCC_det==0)&&(Time_ms<500)==0) VCC_EN=0; else  VCC_EN=1;
  26   1      //    
  27   1        
  28   1      }
  29          
  30          
  31          
  32          void Check_switch()
  33          {
  34   1        
  35   1        
  36   1        if (scan_sec>5)
  37   1        {
  38   2          unlock=0; 
  39   2          scan=0;
  40   2          scan_sec=0;
  41   2        }
  42   1            if (key_holdtime>press_200ms) 
  43   1          {
  44   2              if ((key_holdtime>press_3s)&&(SW==1))
  45   2              {
  46   3                unlock=0;
  47   3                state=standby_mode;
  48   3                switch_state=0;
  49   3                key_holdtime=0;
  50   3                switch_update=0;
  51   3              }
  52   2              else if ((key_holdtime<press_3s)&&(SW==0))
  53   2              {
  54   3                if (unlock==1) switch_state++;
  55   3                    else 
C51 COMPILER V9.54   MAIN                                                                  03/08/2021 17:04:36 PAGE 2   

  56   3                    {   
  57   4                      unlock=1;
  58   4                    }
  59   3                    
  60   3                if ((switch_state==0)&& (unlock==1))
  61   3                    switch_state=1;
  62   3                
  63   3                
  64   3                
  65   3                
  66   3                
  67   3              if (switch_state>2) switch_state=0;
  68   3              switch (switch_state)
  69   3              {
  70   4              case 0:     
  71   4                        
  72   4                          state=standby_mode;
  73   4                          break;
  74   4              case 1:     
  75   4                          
  76   4                          state=ion_mode;
  77   4                          break;
  78   4              case 2:     
  79   4                          
  80   4                          state=uv_mode;
  81   4                          break;
  82   4                } 
  83   3        
  84   3              scan=1;
  85   3              scan_sec=0;
  86   3              EX0=0;
  87   3              switch_update=0;
  88   3              delay_ms(200);
  89   3              key_holdtime=0;
  90   3              }   
  91   2            }
  92   1      
  93   1        
  94   1      }
  95                
  96              
  97          
  98            
  99            
 100            
 101          
 102          void State_process()
 103          {
 104   1          switch (state)
 105   1          {
 106   2        
 107   2        case standby_mode:    
 108   2                          
 109   2                          VCC_EN=1;
 110   2                       
 111   2                          ion_on=0;
 112   2                          UV_on  = 0;
 113   2                          switch_state=0;
 114   2                          LED_type=0;
 115   2                          next_state=standby_mode;
 116   2        
 117   2                           
C51 COMPILER V9.54   MAIN                                                                  03/08/2021 17:04:36 PAGE 3   

 118   2        
 119   2        
 120   2                          break;
 121   2        
 122   2          case uv_mode:       
 123   2                          
 124   2                          DCDC_enable();  
 125   2                          LED_type=2;
 126   2                          ion_on=0;
 127   2                          UV_on=1;
 128   2                          
 129   2                          if (Time_min>=time_T0) 
 130   2                          {
 131   3                            Time_min=0;
 132   3                            next_state=standby_mode; 
 133   3                          }else next_state=uv_mode;
 134   2                          if (USB==1) next_state=standby_mode;
 135   2                          break;
 136   2        
 137   2        
 138   2          case ion_mode:        
 139   2                          
 140   2                          DCDC_enable();  
 141   2                          LED_type=2;
 142   2                          ion_on=1;
 143   2                          UV_on=0;
 144   2                          
 145   2                        
 146   2                          next_state=ion_mode;
 147   2                          if (USB==1) next_state=standby_mode;
 148   2                          break;
 149   2          
 150   2        
 151   2          }
 152   1          
 153   1      state=next_state;
 154   1      
 155   1      
 156   1      }
 157          
 158          
 159          
 160          
 161          
 162          
 163          
 164          
 165          void main(void) 
 166          {
 167   1        IO_Init();
 168   1        InitTime0();
 169   1         
 170   1        InitExtInterrupt();
 171   1      
 172   1        InitParameter() ;
 173   1        
 174   1      
 175   1      
 176   1        while(1) 
 177   1        { 
 178   2        
 179   2      
C51 COMPILER V9.54   MAIN                                                                  03/08/2021 17:04:36 PAGE 4   

 180   2        
 181   2          Check_switch();
 182   2          State_process();
 183   2          
 184   2      
 185   2          Process_Timer();
 186   2         
 187   2          Process_UV();
 188   2          Process_LED();
 189   2         
 190   2          Process_ION(); 
 191   2          Process_sleep();
 192   2          EX0=1;                   //complete the process and enable external SW interrupt
 193   2      
 194   2          
 195   2        } 
 196   1      }
 197          
 198          void int0() interrupt 0
 199          {
 200   1      
 201   1         if ((switch_update==0)&&(SW==1)) 
 202   1         {
 203   2            Time_us=0;
 204   2            Time_ms=0;
 205   2            Time_sec=0;
 206   2            Time_min=0;
 207   2            
 208   2            key_holdtime=0;
 209   2            switch_update=1;
 210   2         }
 211   1      }
 212          
 213          void int1() interrupt 2
 214          {
 215   1       
 216   1      
 217   1      }
 218           
 219          void timer0() interrupt 1
 220          {
 221   1      
 222   1      if (switch_update==1) 
 223   1      {
 224   2        key_holdtime++;
 225   2        
 226   2        
 227   2        
 228   2          
 229   2          }
 230   1         
 231   1        Timer_update=1;
 232   1      }
 233          
 234          
 235          
 236          
 237          void timer2() interrupt 12  
 238          {
 239   1        
 240   1      }
 241          
C51 COMPILER V9.54   MAIN                                                                  03/08/2021 17:04:36 PAGE 5   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    398    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     22    ----
   BIT SIZE         =      7    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
