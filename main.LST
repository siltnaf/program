C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4           
   5          #include "./public/inc/config.h" 
   6          #include "./public/inc/delay.h"  
   7          #include "./public/inc/init.h"
   8          #include "./public/inc/process.h"
   9          
  10          volatile uint8 state,next_state,switch_state;
  11          volatile uint8   LED_type;
  12          volatile uint16 process_time,buz_time,key_holdtime;
  13          volatile uint16 Time_us, Time_ms,Time_sec,Time_min,Time_cnt;
  14          volatile bit Timer_update,Beep, UV_on, ion_on,switch_update;
  15          
  16          
  17          
  18          void DCDC_enable(void)
  19          {
  20   1      
  21   1        
  22   1        
  23   1        
  24   1        SET_INPUT(IO_VCC_det);                
  25   1        if ((VCC_det==0)&&(Time_ms<500)==0) VCC_EN=0; else  VCC_EN=1;
  26   1          
  27   1        
  28   1      }
  29          
  30          
  31          
  32          void Check_switch()
  33          {
  34   1          if (key_holdtime>press_200ms) 
  35   1          {
  36   2              if ((key_holdtime>press_3s)&&(SW==1))
  37   2              {
  38   3                state=standby_mode;
  39   3                switch_state=0;
  40   3                key_holdtime=0;
  41   3                switch_update=0;
  42   3              }
  43   2              else if ((key_holdtime<press_3s)&&(SW==0))
  44   2              {
  45   3              switch_state++;
  46   3              if (switch_state>2) switch_state=0;
  47   3              switch (switch_state)
  48   3              {
  49   4              case 0:     
  50   4                        
  51   4                          state=standby_mode;
  52   4                          break;
  53   4              case 1:     
  54   4                          
  55   4                          state=ion_mode;
C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 2   

  56   4                          break;
  57   4              case 2:     
  58   4                          
  59   4                          state=uv_mode;
  60   4                          break;
  61   4                } 
  62   3        
  63   3            
  64   3            
  65   3              switch_update=0;
  66   3              key_holdtime=0;
  67   3              delay_ms(250);
  68   3              }   
  69   2            }
  70   1         
  71   1          
  72   1      
  73   1      
  74   1        
  75   1      }
  76                
  77              
  78          
  79          //  
  80          //void Check_switch()
  81          //{
  82          //  if (scan_sec>5)
  83          //  {
  84          //    unlock=0; 
  85          //    scan=0;
  86          //    scan_sec=0;
  87          //  }
  88          //    if (key_holdtime>press_200ms) 
  89          //    {
  90          //      
  91          //      
  92          //        if ((key_holdtime>press_3s)&&(SW1==1))
  93          //        {
  94          //          state=standby_mode;
  95          //          unlock=0;
  96          //          SW1_state=0;
  97          //          key_holdtime=0;
  98          //          SW1_pressed=0;
  99          //          switch_update=0;
 100          //        
 101          //        }
 102          //        else if ((key_holdtime<press_3s)&&(SW1==0))
 103          //        {
 104          //    
 105          //        else if ((key_holdtime<press_3s)&&(SW1==0))
 106          //        {
 107          //    
 108          //          if (unlock==1) SW1_state++;
 109          //              else 
 110          //              {
 111          //              
 112          //                unlock=1;
 113          //              
 114          //              }
 115          //              
 116          //           if ((SW1_state==0)&& (unlock==1))
 117          //              SW1_state=1;
C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 3   

 118          //           
 119          //        if (SW1_state>3) SW1_state=0;
 120          //      
 121          //          switch (SW1_state)
 122          //          {
 123          //          case 0:     
 124          //                  
 125          //                    state=standby_mode;
 126          //                    break;
 127          //          case 1:     
 128          //                    
 129          //                    state=ION_mode;
 130          //                    break;
 131          //          case 2:     
 132          //                  
 133          //                  
 134          //                    state=UVION_mode;
 135          //                    break;
 136          //          case 3:     
 137          //                  
 138          //                  
 139          //                    state=O3_mode;
 140          //                    break;
 141          //        
 142          //        
 143          //          } 
 144          //     
 145          //          scan=1;
 146          //          scan_sec=0;
 147          //          
 148          //          key_holdtime=0;
 149          //          SW1_pressed=0;
 150          //          switch_update=0;
 151          //          delay_ms(250);
 152          //        }
 153          //    }   
 154          //  
 155          //   
 156          //    
 157          
 158          
 159          //  
 160          
 161          //  
 162          //   if ((Time_ms%100)<10)
 163          //   {
 164          //     SW2=0;
 165          //     SET_INPUT(IO_SW2);
 166          //     if ((Time_ms%100)>5) 
 167          //     {
 168          //       EX1=1;
 169          //       EX0=1;
 170          //     }
 171          //   }
 172          //   else 
 173          //   {
 174          //     EX1=0;
 175          //     EX0=0;
 176          //     SET_CMOS(IO_SW2);
 177          //     if (O3_on==1) SW2=1; else SW2=0;
 178          //   }
 179          //     
C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 4   

 180          //    
 181          
 182          
 183          //  
 184          //}
 185                    
 186              
 187            
 188            
 189            
 190          
 191          void State_process()
 192          {
 193   1          switch (state)
 194   1          {
 195   2        
 196   2        case standby_mode:    
 197   2                          
 198   2                          VCC_EN=1;
 199   2                       
 200   2                          ion_on=0;
 201   2                          UV_on  = 0;
 202   2                           
 203   2                          LED_type=0;
 204   2                          next_state=standby_mode;
 205   2        
 206   2                           
 207   2        
 208   2        
 209   2                          break;
 210   2        
 211   2          case uv_mode:       
 212   2                          
 213   2                          DCDC_enable();  
 214   2                          LED_type=2;
 215   2                          ion_on=0;
 216   2                          UV_on=1;
 217   2                          
 218   2                          if (Time_min>=time_T0) 
 219   2                          {
 220   3                            Time_min=0;
 221   3                            next_state=standby_mode; 
 222   3                          }else next_state=uv_mode;
 223   2                          if (USB==1) next_state=standby_mode;
 224   2                          break;
 225   2        
 226   2        
 227   2          case ion_mode:        
 228   2                          
 229   2                          DCDC_enable();  
 230   2                          LED_type=2;
 231   2                          ion_on=1;
 232   2                          UV_on=0;
 233   2                          
 234   2                        
 235   2                          next_state=ion_mode;
 236   2                          if (USB==1) next_state=standby_mode;
 237   2                          break;
 238   2          
 239   2        
 240   2          }
 241   1          
C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 5   

 242   1      state=next_state;
 243   1      
 244   1      
 245   1      }
 246          
 247          
 248          
 249          
 250          
 251          
 252          
 253          
 254          void main(void) 
 255          {
 256   1        IO_Init();
 257   1        InitTime0();
 258   1         
 259   1        InitExtInterrupt();
 260   1      
 261   1        InitParameter() ;
 262   1        
 263   1      
 264   1      
 265   1        while(1) 
 266   1        { 
 267   2        
 268   2      
 269   2        
 270   2          Check_switch();
 271   2          State_process();
 272   2          
 273   2      
 274   2          Process_Timer();
 275   2         
 276   2          Process_UV();
 277   2          Process_LED();
 278   2         
 279   2          Process_ION();
 280   2          Process_sleep();
 281   2      
 282   2      
 283   2          
 284   2        } 
 285   1      }
 286          
 287          void int0() interrupt 0
 288          {
 289   1      
 290   1         if ((switch_update==0)&&(SW==1)) 
 291   1         {
 292   2            Time_us=0;
 293   2            Time_ms=0;
 294   2            Time_sec=0;
 295   2            Time_min=0;
 296   2            
 297   2            key_holdtime=0;
 298   2            switch_update=1;
 299   2         }
 300   1      }
 301          
 302          void int1() interrupt 2
 303          {
C51 COMPILER V9.54   MAIN                                                                  10/14/2020 22:11:17 PAGE 6   

 304   1       
 305   1      
 306   1      }
 307           
 308          void timer0() interrupt 1
 309          {
 310   1      
 311   1      if (switch_update==1) 
 312   1      {
 313   2        key_holdtime++;
 314   2        
 315   2        
 316   2        
 317   2          
 318   2          }
 319   1         
 320   1        Timer_update=1;
 321   1      }
 322          
 323          
 324          
 325          
 326          void timer2() interrupt 12  
 327          {
 328   1        
 329   1      }
 330          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    372    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     20    ----
   BIT SIZE         =      5    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
