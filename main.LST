C51 COMPILER V9.54   MAIN                                                                  04/26/2020 04:52:11 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4          #include "./public/inc/config.h" 
   5          #include "./public/inc/delay.h"  
   6          #include "./public/inc/init.h"
   7          #include "./public/inc/process.h"
   8          
   9          volatile uint8 state,next_state,switch_state,switch_update;
  10          volatile uint8   UV_on,Fan_on, O3_level,LED_type;
  11          volatile uint16 process_time,buz_time,key_holdtime;
  12          volatile uint16 Time_ms,Time_sec,Time_min;
  13          volatile uint8 Timer_update,Beep;
  14          
  15          
  16          void Check_switch()
  17          {
  18   1          if (key_holdtime>press_time) 
  19   1          {
  20   2            switch_state++;
  21   2            if (switch_state>2) switch_state=0;
  22   2           
  23   2            
  24   2            switch (switch_state)
  25   2            {
  26   3              case 0:     
  27   3                          
  28   3                          state=standby_mode;
  29   3                          break;
  30   3              case 1:     
  31   3                          
  32   3                          state=O3_mode;
  33   3                          break;
  34   3              case 2:     
  35   3                        
  36   3                          Time_ms=0;
  37   3                          Time_sec=0;
  38   3                          Time_min=0;
  39   3                          state=UVO3_mode;
  40   3                          break;
  41   3            } 
  42   2            
  43   2            
  44   2            
  45   2            
  46   2            
  47   2            switch_update=0;
  48   2            key_holdtime=0;
  49   2          }   
  50   1        
  51   1       
  52   1          
  53   1      
  54   1      
  55   1        
C51 COMPILER V9.54   MAIN                                                                  04/26/2020 04:52:11 PAGE 2   

  56   1      }
  57                
  58              
  59              
  60              
  61            
  62            
  63            
  64          
  65          void State_process()
  66          {
  67   1          switch (state)
  68   1          {
  69   2        
  70   2        case standby_mode:    
  71   2                            
  72   2        
  73   2                          Fan_on=0;
  74   2        
  75   2                      
  76   2                       
  77   2                          O3_level  = 0;
  78   2                          UV_on  = 0;
  79   2                           
  80   2                          LED_type=0;
  81   2                          next_state=standby_mode;
  82   2                          break;
  83   2        
  84   2        case O3_mode:       
  85   2                
  86   2      
  87   2      //                        //P35 as input
  88   2      //    
  89   2                            P3M1 |=0x20;                        // P3M1 |= 0b00100000;
  90   2                            P3M0 &=0xdf;                        // P3M0 &= 0b11011111;          
  91   2                            if (USB_det==1) Fan_on=1; else Fan_on=0;
  92   2                    
  93   2                        
  94   2                            
  95   2                          LED_type=1;
  96   2                          O3_level=1;
  97   2                          UV_on=0;
  98   2                          
  99   2                          next_state=O3_mode;
 100   2                          break;
 101   2        
 102   2        case UVO3_mode:     
 103   2                     
 104   2                          LED_type=2;
 105   2                          O3_level=2;
 106   2                          UV_on=1;
 107   2                          Fan_on=1;
 108   2                          if (Time_min>time_4min) next_state=UV_mode; else next_state=UVO3_mode;
 109   2                          break;
 110   2        
 111   2        
 112   2        case UV_mode: 
 113   2                       
 114   2                          LED_type=2;
 115   2                          O3_level=0;
 116   2                          UV_on=1;
 117   2                          Fan_on=1;
C51 COMPILER V9.54   MAIN                                                                  04/26/2020 04:52:11 PAGE 3   

 118   2                          if (Time_min>time_5min) 
 119   2                          {
 120   3                            buz_time=0;
 121   3                            Time_ms=0;
 122   3                            Time_sec=0;
 123   3                            next_state=BUZ_mode; 
 124   3                          }
 125   2                            else  next_state=UV_mode;
 126   2                            
 127   2                          break;
 128   2                          
 129   2        case BUZ_mode:
 130   2       
 131   2                          Beep=1;
 132   2                          delay_ms(250);
 133   2                          Beep=0;
 134   2                          delay_ms(250);
 135   2                          Beep=1;
 136   2                          delay_ms(250);
 137   2                          Beep=0;
 138   2                          next_state=standby_mode;
 139   2                            
 140   2                          break;
 141   2        
 142   2          }
 143   1          
 144   1      state=next_state;
 145   1      
 146   1      
 147   1      }
 148          
 149          
 150          
 151          
 152          
 153          
 154          
 155          
 156          
 157          void main(void) 
 158          {
 159   1        IO_Init();
 160   1        InitTime0();
 161   1        InitTime2();
 162   1        InitExtInterrupt();
 163   1      
 164   1        InitParameter() ;
 165   1        while(1) 
 166   1        { 
 167   2        
 168   2        
 169   2          Check_switch();
 170   2          State_process();
 171   2          
 172   2      
 173   2          Process_Timer();
 174   2          Process_FAN();
 175   2          Process_UV();
 176   2          Process_LED();
 177   2          Process_BUZ();
 178   2          Process_O3();
 179   2          
C51 COMPILER V9.54   MAIN                                                                  04/26/2020 04:52:11 PAGE 4   

 180   2        } 
 181   1      }
 182          
 183          void int0() interrupt 0
 184          {
 185   1      
 186   1         if ((switch_update==0)&&(SW==1)) 
 187   1         {
 188   2            
 189   2            key_holdtime=0;
 190   2            switch_update=1;
 191   2         }
 192   1      }
 193          
 194          void int1() interrupt 2
 195          {
 196   1         
 197   1      }
 198          
 199          
 200           
 201          void timer0() interrupt 1
 202          {
 203   1      
 204   1      if (switch_update==1) 
 205   1      {
 206   2        key_holdtime++;
 207   2        
 208   2      }
 209   1      Timer_update=1;
 210   1      
 211   1      }
 212          
 213          void timer2() interrupt 12  
 214          {
 215   1       if (Beep==1) 
 216   1          {
 217   2            
 218   2        //                      P3M1   P3M0
 219   2        //P30(BUZ)->CMOS          0      1
 220   2        //P31(LED/BUZ)->CMOS      0      1
 221   2        //P32(SW)->INPUT          1      0
 222   2        //P33(O3)->OUTPUT         0      0
 223   2        //P34(UV)->CMOS           0      1
 224   2        //P35(FAN)->INPUT         1      0
 225   2        //P31 as CMOS
 226   2            
 227   2            P3M1 &=0xfd;                //P3M1 &=0b11111101;          
 228   2            P3M0 |=0x02;                //P3M0 |=0b00000010;
 229   2            
 230   2            BUZ=~BUZ;
 231   2            LED=~BUZ;
 232   2          }
 233   1          else 
 234   1          { 
 235   2        //                      P3M1   P3M0
 236   2        //P30(BUZ)->CMOS          0      1
 237   2        //P31(LED/BUZ)->INPUT     1      0
 238   2        //P32(SW)->INPUT          1      0
 239   2        //P33(O3)->OUTPUT         0      0
 240   2        //P34(UV)->CMOS           0      1
 241   2        //P35(FAN)->INPUT         1      0
C51 COMPILER V9.54   MAIN                                                                  04/26/2020 04:52:11 PAGE 5   

 242   2            
 243   2          //P31 as high-Z
 244   2            
 245   2          P3M1 |=0x02;                  //P3M1 |=0b00000010;           
 246   2          P3M0 &=0xfd;                  //P3M0 &=0b11111101;
 247   2      
 248   2          }
 249   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    455    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     22    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
