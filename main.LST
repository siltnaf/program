C51 COMPILER V9.54   MAIN                                                                  05/18/2020 12:49:02 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4          #include "./public/inc/config.h" 
   5          #include "./public/inc/delay.h"  
   6          #include "./public/inc/init.h"
   7          #include "./public/inc/process.h"
   8          
   9          volatile uint8 state,next_state,switch_state,switch_update;
  10          volatile uint8   UV_on,Fan_on, O3_level,LED_type;
  11          volatile uint16 process_time,buz_time,key_holdtime;
  12          volatile uint16 Time_ms,Time_sec,Time_min;
  13          volatile uint8 Timer_update,Beep;
  14          
  15          
  16          void Check_switch()
  17          {
  18   1          if (key_holdtime>press_time) 
  19   1          {
  20   2            switch_state++;
  21   2            if (switch_state>2) switch_state=0;
  22   2           
  23   2            Time_ms=0;
  24   2            Time_sec=0;
  25   2            Time_min=0;
  26   2            switch (switch_state)
  27   2            {
  28   3              case 0:     
  29   3                        
  30   3                          state=standby_mode;
  31   3                          break;
  32   3              case 1:     
  33   3                          
  34   3                          state=O3_mode;
  35   3                          break;
  36   3              case 2:     
  37   3                        
  38   3                        
  39   3                          state=UVO3_mode;
  40   3                          break;
  41   3            } 
  42   2            
  43   2            
  44   2            
  45   2            
  46   2            
  47   2            switch_update=0;
  48   2            key_holdtime=0;
  49   2          }   
  50   1        
  51   1       
  52   1          
  53   1      
  54   1      
  55   1        
C51 COMPILER V9.54   MAIN                                                                  05/18/2020 12:49:02 PAGE 2   

  56   1      }
  57                
  58              
  59              
  60              
  61            
  62            
  63            
  64          
  65          void State_process()
  66          {
  67   1          switch (state)
  68   1          {
  69   2        
  70   2        case standby_mode:    
  71   2                          
  72   2              
  73   2                          VCC_EN=1;
  74   2        
  75   2                          Fan_on=0;
  76   2        
  77   2                          
  78   2                          O3_level  = 0;
  79   2                          UV_on  = 0;
  80   2                           
  81   2                          LED_type=0;
  82   2                          next_state=standby_mode;
  83   2                          break;
  84   2        
  85   2        case O3_mode:       
  86   2                          
  87   2      
  88   2      //                        //P35 as input
  89   2      //    
  90   2      //                      P3M1 |=0x20;                        // P3M1 |= 0b00100000;
  91   2      //                      P3M0 &=0xdf;                        // P3M0 &= 0b11011111;          
  92   2      //                      if ((VCC_det==0) &&(Time_ms<500)) VCC_EN=0;else VCC_EN=1;
  93   2                          
  94   2                            
  95   2                         LED_type=1;
  96   2                          O3_level=1;
  97   2                          UV_on=0;
  98   2                          
  99   2                          next_state=O3_mode;
 100   2                          break;
 101   2        
 102   2        case UVO3_mode:     
 103   2                          
 104   2      //                        //P35 as input
 105   2      //    
 106   2      //                      P3M1 |=0x20;                        // P3M1 |= 0b00100000;
 107   2      //                      P3M0 &=0xdf;                        // P3M0 &= 0b11011111;          
 108   2      //                      if ((VCC_det==0) &&(Time_ms<500)) VCC_EN=0;else VCC_EN=1;
 109   2      //  
 110   2                         LED_type=2;
 111   2                          O3_level=2;
 112   2                          UV_on=1;
 113   2                          Fan_on=1;
 114   2                          if (Time_min>=time_4min) next_state=UV_mode; else next_state=UVO3_mode;
 115   2                          break;
 116   2        
 117   2        
C51 COMPILER V9.54   MAIN                                                                  05/18/2020 12:49:02 PAGE 3   

 118   2        case UV_mode: 
 119   2                            
 120   2      ////                        //P35 as input
 121   2      ////    
 122   2      //                      P3M1 |=0x20;                        // P3M1 |= 0b00100000;
 123   2      //                      P3M0 &=0xdf;                        // P3M0 &= 0b11011111;          
 124   2      //                      if ((VCC_det==0) &&(Time_ms<500)) VCC_EN=0;else VCC_EN=1;
 125   2        
 126   2                        LED_type=2;
 127   2                          O3_level=0;
 128   2                          UV_on=1;
 129   2        
 130   2                          
 131   2        
 132   2        
 133   2                          Fan_on=1;
 134   2                          if (Time_min>=time_5min) 
 135   2                          {
 136   3                            buz_time=0;
 137   3                            Time_ms=0;
 138   3                            Time_sec=0;
 139   3                            next_state=BUZ_mode; 
 140   3                          }
 141   2                            else  next_state=UV_mode;
 142   2                            
 143   2                          break;
 144   2                          
 145   2        case BUZ_mode:
 146   2                          
 147   2                           
 148   2                          Beep=1;
 149   2                          delay_ms(250);
 150   2                          Beep=0;
 151   2                          delay_ms(250);
 152   2                          Beep=1;
 153   2                          delay_ms(250);
 154   2                          Beep=0;
 155   2                          next_state=standby_mode;
 156   2                    
 157   2                          break;
 158   2        
 159   2          }
 160   1          
 161   1      state=next_state;
 162   1      
 163   1      
 164   1      }
 165          
 166          
 167          
 168          
 169          
 170          
 171          
 172          
 173          
 174          void main(void) 
 175          {
 176   1        IO_Init();
 177   1        InitTime0();
 178   1        InitTime2();
 179   1        InitExtInterrupt();
C51 COMPILER V9.54   MAIN                                                                  05/18/2020 12:49:02 PAGE 4   

 180   1      
 181   1        InitParameter() ;
 182   1        while(1) 
 183   1        { 
 184   2        
 185   2      
 186   2      
 187   2          Check_switch();
 188   2          State_process();
 189   2          
 190   2      
 191   2          Process_Timer();
 192   2          Process_FAN();
 193   2          Process_UV();
 194   2          Process_LED();
 195   2          Process_BUZ();
 196   2          Process_O3();
 197   2          
 198   2        } 
 199   1      }
 200          
 201          void int0() interrupt 0
 202          {
 203   1      
 204   1         if ((switch_update==0)&&(SW==1)) 
 205   1         {
 206   2            
 207   2            key_holdtime=0;
 208   2            switch_update=1;
 209   2         }
 210   1      }
 211          
 212          void int1() interrupt 2
 213          {
 214   1         
 215   1      }
 216          
 217          
 218           
 219          void timer0() interrupt 1
 220          {
 221   1      
 222   1      if (switch_update==1) 
 223   1      {
 224   2        key_holdtime++;
 225   2        
 226   2        
 227   2        
 228   2          
 229   2          }
 230   1         
 231   1        Timer_update=1;
 232   1      }
 233          
 234          
 235          
 236          
 237          void timer2() interrupt 12  
 238          {
 239   1       if (Beep==1) 
 240   1          {
 241   2          
C51 COMPILER V9.54   MAIN                                                                  05/18/2020 12:49:02 PAGE 5   

 242   2          //P32 as output
 243   2        //                      P3M1   P3M0
 244   2        //P30(BUZ)->INPUT         1      1
 245   2        //P31(LED)->CMOS          0      1
 246   2        //P32(SW/BUZ)->INPUT      0      1
 247   2        //P33(O3)->OUTPUT         0      0
 248   2        //P34(UV)->CMOS           0      1
 249   2        //P35(FAN)->OUTPUT        0      0
 250   2              
 251   2      
 252   2        //P3M1 &=0b1111 1011;
 253   2        //P3M0 |=0b0000 0100;
 254   2        
 255   2        
 256   2          P3M1 &= 0xfb;               //P32 as CMOS output  
 257   2          P3M0 |= 0x04;
 258   2            
 259   2          BUZ=~BUZ;
 260   2      }
 261   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    425    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     22    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
