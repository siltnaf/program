C51 COMPILER V9.54   MAIN                                                                  04/25/2020 19:42:31 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4          #include "./public/inc/config.h" 
   5          #include "./public/inc/delay.h"  
   6          #include "./public/inc/init.h"
   7          #include "./public/inc/process.h"
   8          
   9          volatile uint8 state,next_state,switch_state,switch_update;
  10          volatile uint8 BUZ_on, UV_on,Fan_on, O3_level,LED_type;
  11          volatile uint16 process_time,buz_time,key_holdtime;
  12          volatile uint16 Time_ms,Time_sec,Time_min;
  13          volatile uint8 Timer_update;
  14          
  15          
  16          void Check_switch()
  17          {
  18   1          if (key_holdtime>press_time) 
  19   1          {
  20   2            switch_state++;
  21   2            if (switch_state>2) switch_state=0;
  22   2           
  23   2            
  24   2            switch (switch_state)
  25   2            {
  26   3              case 0:     
  27   3                          
  28   3                          state=standby_mode;
  29   3                          break;
  30   3              case 1:     
  31   3                          
  32   3                          state=O3_mode;
  33   3                          break;
  34   3              case 2:     
  35   3                        
  36   3                          Time_ms=0;
  37   3                          Time_sec=0;
  38   3                          Time_min=0;
  39   3                          state=UVO3_mode;
  40   3                          break;
  41   3            } 
  42   2            
  43   2            
  44   2            
  45   2            
  46   2            
  47   2            switch_update=0;
  48   2            key_holdtime=0;
  49   2          }   
  50   1        
  51   1       
  52   1          
  53   1      
  54   1      
  55   1        
C51 COMPILER V9.54   MAIN                                                                  04/25/2020 19:42:31 PAGE 2   

  56   1      }
  57                
  58              
  59              
  60              
  61            
  62            
  63            
  64          
  65          void State_process()
  66          {
  67   1          switch (state)
  68   1          {
  69   2        
  70   2        case standby_mode:    
  71   2                            
  72   2                    
  73   2                          BUZ_on = 0;
  74   2                          O3_level  = 0;
  75   2                          UV_on  = 0;
  76   2                          Fan_on =0;
  77   2                          LED_type=0;
  78   2                          next_state=standby_mode;
  79   2                          break;
  80   2        
  81   2        case O3_mode:       
  82   2                          BUZ_on=0;
  83   2                          LED_type=1;
  84   2                          O3_level=1;
  85   2                          UV_on=0;
  86   2                          if (USB_det==1) Fan_on=1; else Fan_on=0;
  87   2                          next_state=O3_mode;
  88   2                          break;
  89   2        
  90   2        case UVO3_mode:     
  91   2                          BUZ_on=0;
  92   2                          LED_type=2;
  93   2                          O3_level=2;
  94   2                          UV_on=1;
  95   2                          Fan_on=1;
  96   2                          if (Time_min>time_4min) next_state=UV_mode; else next_state=UVO3_mode;
  97   2                          break;
  98   2        
  99   2        
 100   2        case UV_mode: 
 101   2                          BUZ_on=0;
 102   2                          LED_type=2;
 103   2                          O3_level=0;
 104   2                          UV_on=1;
 105   2                          Fan_on=1;
 106   2                          if (Time_min>time_5min) 
 107   2                          {
 108   3                            buz_time=0;
 109   3                            Time_ms=0;
 110   3                            Time_sec=0;
 111   3                            next_state=BUZ_mode; 
 112   3                          }
 113   2                            else next_state=UV_mode;
 114   2                          break;
 115   2                          
 116   2        case BUZ_mode:
 117   2                          BUZ_on=1;
C51 COMPILER V9.54   MAIN                                                                  04/25/2020 19:42:31 PAGE 3   

 118   2                          if (Time_sec>time_5s) next_state=standby_mode;
 119   2                          break;
 120   2        
 121   2          }
 122   1          
 123   1      state=next_state;
 124   1      
 125   1      
 126   1      }
 127          
 128          
 129          
 130          
 131          
 132          
 133          
 134          
 135          
 136          void main(void) 
 137          {
 138   1        IO_Init();
 139   1        InitTime0();
 140   1        InitExtInterrupt();
 141   1      
 142   1        InitParameter() ;
 143   1        while(1) 
 144   1        { 
 145   2        
 146   2        
 147   2          Check_switch();
 148   2          State_process();
 149   2          
 150   2      
 151   2          Process_Timer();
 152   2          Process_FAN();
 153   2          Process_UV();
 154   2          Process_LED();
 155   2          Process_BUZ();
 156   2          Process_O3();
 157   2          
 158   2        } 
 159   1      }
 160          
 161          void int0() interrupt 0
 162          {
 163   1      
 164   1         if ((switch_update==0)&&(SW==1)) 
 165   1         {
 166   2            
 167   2            key_holdtime=0;
 168   2            switch_update=1;
 169   2         }
 170   1      }
 171          
 172          void int1() interrupt 2
 173          {
 174   1         
 175   1      }
 176          
 177          
 178          // 定时器0中断处理函数
 179          void timer0() interrupt 1
C51 COMPILER V9.54   MAIN                                                                  04/25/2020 19:42:31 PAGE 4   

 180          {
 181   1      BUZ=~BUZ;
 182   1      if (switch_update==1) 
 183   1      {
 184   2        key_holdtime++;
 185   2        
 186   2      }
 187   1      Timer_update=1;
 188   1      
 189   1      }
 190          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    394    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     22    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
