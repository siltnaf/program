C51 COMPILER V9.54   MAIN                                                                  01/25/2021 08:21:37 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN Main.OBJ
COMPILER INVOKED BY: c:\Keil_v5\C51\BIN\C51.EXE Main.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG TABS(2)

line level    source

   1          
   2          #include "STC15F104E.h"
   3          
   4           
   5          #include "./public/inc/config.h" 
   6          #include "./public/inc/delay.h"  
   7          #include "./public/inc/init.h"
   8          #include "./public/inc/process.h"
   9          
  10          volatile uint8 state,next_state,switch_state;
  11          volatile uint8   LED_type;
  12          volatile uint16 process_time,buz_time,key_holdtime;
  13          volatile uint16 Time_us, Time_ms,Time_sec,Time_min,power_refresh;
  14          volatile bit Timer_update,UV_on,switch_update,refresh;
  15          
  16          
  17          void Enable_power()
  18          {
  19   1        
  20   1      
  21   1        if (((power_refresh%20)==0)&&((Time_ms<500)==0)) 
  22   1        {
  23   2          
  24   2          VCC_EN=0;
  25   2        } else VCC_EN=1;
  26   1           
  27   1        
  28   1        
  29   1      }
  30          
  31          
  32          
  33          void Check_switch()
  34          {
  35   1           
  36   1      
  37   1        if (key_holdtime>press_200ms) 
  38   1          {
  39   2              if ((key_holdtime>press_3s)&&(SW==1))
  40   2              {
  41   3                state=standby_mode;
  42   3                switch_state=0;
  43   3                key_holdtime=0;
  44   3                switch_update=0;
  45   3              }
  46   2              else if ((key_holdtime<press_3s)&&(SW==0))
  47   2              {
  48   3              switch_state++;
  49   3              if (switch_state>4) switch_state=0;
  50   3        
  51   3        
  52   3        
  53   3        
  54   3            switch (switch_state)
  55   3            {
C51 COMPILER V9.54   MAIN                                                                  01/25/2021 08:21:37 PAGE 2   

  56   4              case 0:     
  57   4                
  58   4                          LED_type=0;
  59   4                          state=standby_mode;
  60   4                          break;
  61   4      
  62   4              case 1:     power_refresh=0;
  63   4                          LED_type=4;
  64   4                          state=quite_mode;
  65   4                          break;
  66   4              
  67   4              case 2:     
  68   4                          power_refresh=0;
  69   4                          LED_type=1;
  70   4                          state=speed0_mode;
  71   4                          break;
  72   4              case 3:     
  73   4                          power_refresh=0;
  74   4                          LED_type=2;
  75   4              
  76   4                          state=speed1_mode;
  77   4                          break;
  78   4              
  79   4              case 4:     
  80   4                          power_refresh=0;
  81   4                           LED_type=3;
  82   4                          state=speed2_mode;
  83   4                          break;
  84   4              
  85   4            
  86   4            
  87   4              
  88   4            } 
  89   3            
  90   3        
  91   3            Time_ms=0;
  92   3            Time_sec=0;
  93   3            Time_min=0;
  94   3            switch_update=0;
  95   3            key_holdtime=0;
  96   3            delay_ms(250);
  97   3          }   
  98   2        
  99   2         
 100   2          
 101   2        }
 102   1      
 103   1        
 104   1      }
 105                
 106              
 107              
 108              
 109            
 110            
 111            
 112          
 113          void State_process()
 114          {
 115   1          switch (state)
 116   1          {
 117   2        
C51 COMPILER V9.54   MAIN                                                                  01/25/2021 08:21:37 PAGE 3   

 118   2        case standby_mode:    
 119   2                          
 120   2                          SPEED0=0;
 121   2                          LED_type=0;
 122   2                          SPEED0=0;
 123   2                          SPEED1=0;
 124   2                          switch_state=0;
 125   2                          SET_INPUT(IO_SPEED2);
 126   2                          next_state=standby_mode;
 127   2        
 128   2                           
 129   2        
 130   2        
 131   2                          break;
 132   2        
 133   2        
 134   2        case quite_mode:
 135   2                        Enable_power();
 136   2                        
 137   2                          if (Time_min%2==0) 
 138   2                            {
 139   3                            SPEED0=1;
 140   3                            
 141   3                            }
 142   2                              else SPEED0=0;
 143   2                          
 144   2                        
 145   2                          SPEED1=0;
 146   2                          SET_INPUT(IO_SPEED2);
 147   2                          next_state=quite_mode;
 148   2                          break;
 149   2        
 150   2        
 151   2        case speed0_mode:       
 152   2                          
 153   2                          Enable_power();
 154   2                           
 155   2                          SPEED0=1;
 156   2                          SPEED1=0;
 157   2                          SET_INPUT(IO_SPEED2);
 158   2                         
 159   2                          next_state=speed0_mode;
 160   2                          break;
 161   2        
 162   2        case speed1_mode:       
 163   2                          
 164   2                          Enable_power();
 165   2                          SPEED0=1;
 166   2                          SPEED1=1;
 167   2                          SET_INPUT(IO_SPEED2);
 168   2                         
 169   2                          next_state=speed1_mode;
 170   2                          break;
 171   2        
 172   2        case speed2_mode:     
 173   2                          Enable_power();
 174   2                          SPEED0=1;
 175   2                          SPEED1=1;
 176   2                          SET_CMOS(IO_SPEED2);
 177   2                          SPEED2=0;
 178   2      
 179   2                       
C51 COMPILER V9.54   MAIN                                                                  01/25/2021 08:21:37 PAGE 4   

 180   2                          
 181   2                         next_state=speed2_mode;
 182   2                          break;
 183   2        
 184   2        
 185   2        
 186   2      
 187   2      
 188   2      
 189   2        
 190   2          }
 191   1          
 192   1      state=next_state;
 193   1      
 194   1      
 195   1      }
 196          
 197          
 198          
 199          
 200          
 201          
 202          
 203          
 204          void main(void) 
 205          {
 206   1        IO_Init();
 207   1        InitTime0();
 208   1        InitTime2();
 209   1        InitExtInterrupt();
 210   1      
 211   1        InitParameter() ;
 212   1      
 213   1        while(1) 
 214   1        { 
 215   2        
 216   2      
 217   2          
 218   2          Check_switch();
 219   2          State_process();
 220   2          
 221   2      
 222   2          Process_Timer();
 223   2       
 224   2          Process_LED();
 225   2         
 226   2        
 227   2          Process_sleep();
 228   2      
 229   2      
 230   2          
 231   2        } 
 232   1      }
 233          
 234          void int0() interrupt 0
 235          {
 236   1      
 237   1         if ((switch_update==0)&&(SW==1)) 
 238   1         {
 239   2            Time_us=0;
 240   2            Time_ms=0;
 241   2            Time_sec=0;
C51 COMPILER V9.54   MAIN                                                                  01/25/2021 08:21:37 PAGE 5   

 242   2            Time_min=0;
 243   2            
 244   2            key_holdtime=0;
 245   2            switch_update=1;
 246   2         }
 247   1      }
 248          
 249          void int1() interrupt 2
 250          {
 251   1         
 252   1      }
 253          
 254          
 255           
 256          void timer0() interrupt 1
 257          {
 258   1      
 259   1      if (switch_update==1) 
 260   1      {
 261   2        key_holdtime++;
 262   2        
 263   2        
 264   2        
 265   2          
 266   2          }
 267   1         
 268   1        Timer_update=1;
 269   1      }
 270          
 271          
 272          
 273          
 274          void timer2() interrupt 12  
 275          {
 276   1      
 277   1           
 278   1      }
 279          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    498    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     20    ----
   BIT SIZE         =      4    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
